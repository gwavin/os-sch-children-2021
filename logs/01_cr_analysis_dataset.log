-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /workspace/logs/01_cr_analysis_dataset.log
  log type:  text
 opened on:  27 Jul 2021, 11:18:16

. 
. 
. *Import dataset into STATA
. import delimited "output/input", clear
(62 vars, 30,000 obs)

. /* CONVERT STRINGS TO DATE===================================================
> =*/
. /* Comorb dates and TPP case outcome dates are given with month only, so addi
> ng day 
> 15 to enable  them to be processed as dates                                  
>                                                      */
. 
. *cr date for diabetes based on adjudicated type
. gen diabetes=type1_diabetes if diabetes_type=="T1DM"
(29,824 missing values generated)

. replace diabetes=type2_diabetes if diabetes_type=="T2DM"
(1,146 real changes made)

. replace diabetes=unknown_diabetes if diabetes_type=="UNKNOWN_DM"
(114 real changes made)

. 
. drop type1_diabetes type2_diabetes unknown_diabetes

. 
. foreach var of varlist  chronic_respiratory_disease ///
>                                                 chronic_cardiac_disease  ///
>                                                 diabetes ///
>                                                 cancer_haem  ///
>                                                 cancer_nonhaem  ///
>                                                 permanent_immunodeficiency  /
> //
>                                                 temporary_immunodeficiency  /
> //
>                                                 dialysis                     
>                    ///
>                                                 kidney_transplant            
>            ///
>                                                 other_transplant             
>            /// 
>                                                 asplenia                     
>    /// 
>                                                 chronic_liver_disease  ///
>                                                 other_neuro  ///
>                                                 stroke_dementia              
>            ///
>                                                 esrf  ///
>                                                 hypertension  ///
>                                                 ra_sle_psoriasis  ///
>                                                 bmi_date_measured   ///
>                                                 bp_sys_date_measured   ///
>                                                 bp_dias_date_measured   ///
>                                                 creatinine_date  ///
>                                                 smoking_status_date ///
>                                                 dereg_date  ///
>                                                 {
  2.                                                         
.                 capture confirm string variable `var'
  3.                 if _rc!=0 {
  4.                         assert `var'==.
  5.                         rename `var' `var'_date
  6.                 }
  7.         
.                 else {
  8.                                 replace `var' = `var' + "-15"
  9.                                 rename `var' `var'_dstr
 10.                                 replace `var'_dstr = " " if `var'_dstr == 
> "-15"
 11.                                 gen `var'_date = date(`var'_dstr, "YMD") 
 12.                                 order `var'_date, after(`var'_dstr)
 13.                                 drop `var'_dstr
 14.                 }
 15.         
.         format `var'_date %td
 16. }
variable chronic_respiratory_disease was str7 now str10
(30,000 real changes made)
(24,000 real changes made)
(24,000 missing values generated)
variable chronic_cardiac_disease was str7 now str10
(30,000 real changes made)
(24,000 real changes made)
(24,000 missing values generated)
variable diabetes was str7 now str10
(30,000 real changes made)
(28,564 real changes made)
(28,564 missing values generated)
variable cancer_haem was str7 now str10
(30,000 real changes made)
(24,000 real changes made)
(24,000 missing values generated)
variable cancer_nonhaem was str7 now str10
(30,000 real changes made)
(24,000 real changes made)
(24,000 missing values generated)
variable permanent_immunodeficiency was str7 now str10
(30,000 real changes made)
(24,000 real changes made)
(24,000 missing values generated)
variable dialysis was str7 now str10
(30,000 real changes made)
(24,000 real changes made)
(24,000 missing values generated)
variable kidney_transplant was str7 now str10
(30,000 real changes made)
(24,000 real changes made)
(24,000 missing values generated)
variable other_transplant was str7 now str10
(30,000 real changes made)
(24,000 real changes made)
(24,000 missing values generated)
variable asplenia was str7 now str10
(30,000 real changes made)
(24,000 real changes made)
(24,000 missing values generated)
variable chronic_liver_disease was str7 now str10
(30,000 real changes made)
(24,000 real changes made)
(24,000 missing values generated)
variable other_neuro was str7 now str10
(30,000 real changes made)
(24,000 real changes made)
(24,000 missing values generated)
variable stroke_dementia was str7 now str10
(30,000 real changes made)
(24,000 real changes made)
(24,000 missing values generated)
variable esrf was str7 now str10
(30,000 real changes made)
(24,000 real changes made)
(24,000 missing values generated)
variable hypertension was str7 now str10
(30,000 real changes made)
(24,000 real changes made)
(24,000 missing values generated)
variable ra_sle_psoriasis was str7 now str10
(30,000 real changes made)
(24,000 real changes made)
(24,000 missing values generated)
variable bmi_date_measured was str7 now str10
(30,000 real changes made)
(1,500 real changes made)
(1,500 missing values generated)
variable bp_sys_date_measured was str7 now str10
(30,000 real changes made)
(1,500 real changes made)
(1,500 missing values generated)
variable bp_dias_date_measured was str7 now str10
(30,000 real changes made)
(1,500 real changes made)
(1,500 missing values generated)
variable creatinine_date was str7 now str10
(30,000 real changes made)
(1,500 real changes made)
(1,500 missing values generated)
variable smoking_status_date was str7 now str10
(30,000 real changes made)
(1,500 real changes made)
(1,500 missing values generated)
variable dereg_date was str7 now str10
(30,000 real changes made)
(29,919 real changes made)
(29,919 missing values generated)

. 
. * Recode to dates from the strings 
. foreach var of varlist covid_icu_date positive_covid_test       ///
> covid_tpp_codes_clinical covid_tpp_codes_test covid_tpp_codes_seq ///
> died_date_ons covid_admission_date covid_tpp_probable ///
> covid_vacc_date  covid_vacc_second_dose_date    {
  2.                                                 
.         confirm string variable `var'
  3.         rename `var' `var'_dstr
  4.         gen `var' = date(`var'_dstr, "YMD")
  5.         drop `var'_dstr
  6.         format `var' %td 
  7.         
. }
(5,999 missing values generated)
(24,000 missing values generated)
(15,000 missing values generated)
(15,000 missing values generated)
(15,000 missing values generated)
(5,999 missing values generated)
(16,725 missing values generated)
(1,500 missing values generated)
(15,000 missing values generated)
(21,000 missing values generated)

. 
. gen covid_admission_primary_date = covid_admission_date ///
> if (covid_admission_primary_diagnosi == "U071"| covid_admission_primary_diagn
> osi == "U072")
(23,324 missing values generated)

. 
. gen  covid_primary_care_codes_only=covid_tpp_probable
(1,500 missing values generated)

. format covid_primary_care_codes_only %td

. replace covid_tpp_probable=positive_covid_test_ever if covid_tpp_probable==. 
> & covid_tpp_probable>positive_covid_test
(317 real changes made)

. 
. 
. /*Tab all variables in initial extract*/
. sum, d f

                       dereg_date_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%    15dec2020      15dec2020
 5%    15dec2020      15dec2020
10%    15jan2021      15dec2020       Obs                  81
25%    15feb2021      15dec2020       Sum of Wgt.          81

50%    15apr2021                      Mean          14apr2021
                        Largest       Std. Dev.      70.83449
75%    15jun2021      15jul2021
90%    15jul2021      15jul2021       Variance       5017.525
95%    15jul2021      15jul2021       Skewness      -.0977859
99%    15jul2021      15jul2021       Kurtosis       1.659767

                       ethnicity_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%         1970           1970
 5%         1972           1970
10%         1975           1970       Obs              27,001
25%         1982           1970       Sum of Wgt.      27,001

50%         1995                      Mean           1995.077
                        Largest       Std. Dev.      14.84237
75%         2008           2021
90%         2016           2021       Variance       220.2961
95%         2018           2021       Skewness       .0197229
99%         2021           2021       Kurtosis       1.801788

                   bmi_date_measured_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%    15feb2015      15feb2015
 5%    15jun2015      15feb2015
10%    15oct2015      15feb2015       Obs              28,500
25%    15sep2016      15feb2015       Sum of Wgt.      28,500

50%    15may2018                      Mean          03may2018
                        Largest       Std. Dev.      681.6759
75%    15dec2019      15jul2021
90%    15dec2020      15jul2021       Variance       464682.1
95%    15apr2021      15jul2021       Skewness       -.004579
99%    15jul2021      15jul2021       Kurtosis       1.806588

                  bp_sys_date_measured_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%    15jul1970      15jan1970
 5%    15jul1972      15jan1970
10%    15mar1975      15jan1970       Obs              28,500
25%    15jan1983      15jan1970       Sum of Wgt.      28,500

50%    15jun1995                      Mean          05aug1995
                        Largest       Std. Dev.      5368.025
75%    15may2008      15dec2020
90%    15nov2015      15dec2020       Variance       2.88e+07
95%    15jun2018      15dec2020       Skewness      -.0066246
99%    15jul2020      15dec2020       Kurtosis       1.801862

                 bp_dias_date_measured_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%    15jun1970      15jan1970
 5%    15may1972      15jan1970
10%    15nov1974      15jan1970       Obs              28,500
25%    15jul1982      15jan1970       Sum of Wgt.      28,500

50%    15may1995                      Mean          11may1995
                        Largest       Std. Dev.      5389.997
75%    15feb2008      15dec2020
90%    30nov2015      15dec2020       Variance       2.91e+07
95%    15may2018      15dec2020       Skewness       .0067397
99%    15jun2020      15dec2020       Kurtosis       1.803721

                    creatinine_date_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%    15mar2019      15mar2019
 5%    15apr2019      15mar2019
10%    15may2019      15mar2019       Obs              28,500
25%    15aug2019      15mar2019       Sum of Wgt.      28,500

50%    15jan2020                      Mean          24jan2020
                        Largest       Std. Dev.      191.2302
75%    15jul2020      15dec2020
90%    15oct2020      15dec2020       Variance       36568.98
95%    15nov2020      15dec2020       Skewness       .0018427
99%    15dec2020      15dec2020       Kurtosis       1.794987

                  smoking_status_date_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%    15jul1970      15jan1970
 5%    15jun1972      15jan1970
10%    15mar1975      15jan1970       Obs              28,500
25%    15nov1982      15jan1970       Sum of Wgt.      28,500

50%    15jun1995                      Mean          07jun1995
                        Largest       Std. Dev.      5342.606
75%    15jan2008      15dec2020
90%    15aug2015      15dec2020       Variance       2.85e+07
95%    15apr2018      15dec2020       Skewness      -.0013785
99%    30may2020      15dec2020       Kurtosis       1.814617

              chronic_respiratory_disease_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%    15sep1970      15jan1970
 5%    15aug1972      15jan1970
10%    15mar1975      15jan1970       Obs               6,000
25%    30may1983      15jan1970       Sum of Wgt.       6,000

50%    15nov1995                      Mean          02nov1995
                        Largest       Std. Dev.       5344.31
75%    15may2008      15dec2020
90%    15feb2016      15dec2020       Variance       2.86e+07
95%    15jun2018      15dec2020       Skewness      -.0206701
99%    15jul2020      15dec2020       Kurtosis       1.817217

                chronic_cardiac_disease_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%    15jun1970      15jan1970
 5%    15jul1972      15jan1970
10%    15feb1975      15jan1970       Obs               6,000
25%    15dec1982      15jan1970       Sum of Wgt.       6,000

50%    30aug1995                      Mean          13jul1995
                        Largest       Std. Dev.      5367.645
75%    15mar2008      15dec2020
90%    15dec2015      15dec2020       Variance       2.88e+07
95%    15jun2018      15dec2020       Skewness      -.0036537
99%    15jul2020      15dec2020       Kurtosis       1.807829

                   hba1c_mmol_per_mol_date
-------------------------------------------------------------
no observations

                    hba1c_percentage_date
-------------------------------------------------------------
no observations

                      cancer_haem_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%    15jun1970      15jan1970
 5%    15apr1972      15jan1970
10%    15nov1974      15jan1970       Obs               6,000
25%    15mar1982      15jan1970       Sum of Wgt.       6,000

50%    15apr1995                      Mean          20mar1995
                        Largest       Std. Dev.      5424.797
75%    15jan2008      15nov2020
90%    30dec2015      15dec2020       Variance       2.94e+07
95%    15may2018      15dec2020       Skewness       .0256584
99%    15may2020      15dec2020       Kurtosis       1.784321

                     cancer_nonhaem_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%    15jul1970      15jan1970
 5%    15aug1972      15jan1970
10%    15feb1975      15jan1970       Obs               6,000
25%    15nov1982      15jan1970       Sum of Wgt.       6,000

50%    30aug1995                      Mean          28sep1995
                        Largest       Std. Dev.      5440.514
75%    15nov2008      15dec2020
90%    15jun2016      15dec2020       Variance       2.96e+07
95%    15sep2018      15dec2020       Skewness      -.0100853
99%    15jul2020      15dec2020       Kurtosis        1.77498

               permanent_immunodeficiency_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%    15jul1970      15jan1970
 5%    15aug1972      15jan1970
10%    15feb1975      15jan1970       Obs               6,000
25%    15sep1982      15jan1970       Sum of Wgt.       6,000

50%    15jul1995                      Mean          03jun1995
                        Largest       Std. Dev.      5340.868
75%    15feb2008      15dec2020
90%    15sep2015      15dec2020       Variance       2.85e+07
95%    15may2018      15dec2020       Skewness       .0017061
99%    15jun2020      15dec2020       Kurtosis       1.811926

                        asplenia_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%    15jul1970      15jan1970
 5%    15aug1972      15jan1970
10%    30apr1975      15jan1970       Obs               6,000
25%    15dec1982      15jan1970       Sum of Wgt.       6,000

50%    15apr1995                      Mean          02jun1995
                        Largest       Std. Dev.      5326.998
75%    15jan2008      15dec2020
90%    15dec2015      15dec2020       Variance       2.84e+07
95%    30jun2018      15dec2020       Skewness       .0273358
99%    15jul2020      15dec2020       Kurtosis       1.836187

               temporary_immunodeficiency_date
-------------------------------------------------------------
no observations

                 chronic_liver_disease_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%    15jun1970      15jan1970
 5%    15jul1972      15jan1970
10%    15apr1975      15jan1970       Obs               6,000
25%    15may1983      15jan1970       Sum of Wgt.       6,000

50%    15feb1996                      Mean          13oct1995
                        Largest       Std. Dev.      5323.716
75%    15apr2008      15dec2020
90%    15sep2015      15dec2020       Variance       2.83e+07
95%    15may2018      15dec2020       Skewness      -.0400084
99%    15may2020      15dec2020       Kurtosis       1.829421

                    stroke_dementia_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%    15jul1970      15jan1970
 5%    15jun1972      15jan1970
10%    15jan1975      15jan1970       Obs               6,000
25%    15oct1982      15jan1970       Sum of Wgt.       6,000

50%    15jul1995                      Mean          31jul1995
                        Largest       Std. Dev.      5414.044
75%    15oct2008      15dec2020
90%    15jan2016      15dec2020       Variance       2.93e+07
95%    15jun2018      15dec2020       Skewness      -.0039346
99%    15jul2020      15dec2020       Kurtosis       1.776193

                      other_neuro_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%    15jul1970      15jan1970
 5%    15jul1972      15jan1970
10%    15dec1974      15jan1970       Obs               6,000
25%    15oct1982      15jan1970       Sum of Wgt.       6,000

50%    15jan1996                      Mean          27aug1995
                        Largest       Std. Dev.      5402.372
75%    15sep2008      15dec2020
90%    15dec2015      15dec2020       Variance       2.92e+07
95%    15jul2018      15dec2020       Skewness      -.0220363
99%    15may2020      15dec2020       Kurtosis       1.785569

                          esrf_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%    15jun1970      15jan1970
 5%    15aug1972      15jan1970
10%    15feb1975      15jan1970       Obs               6,000
25%    15nov1982      15jan1970       Sum of Wgt.       6,000

50%    15may1995                      Mean          01jul1995
                        Largest       Std. Dev.       5371.47
75%    15mar2008      15dec2020
90%    15dec2015      15dec2020       Variance       2.89e+07
95%    15jun2018      15dec2020       Skewness       .0093215
99%    15aug2020      15dec2020       Kurtosis       1.800458

                        dialysis_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%    30jun1970      15jan1970
 5%    15jul1972      15jan1970
10%    15dec1974      15jan1970       Obs               6,000
25%    30aug1982      15jan1970       Sum of Wgt.       6,000

50%    15may1995                      Mean          20jun1995
                        Largest       Std. Dev.      5381.652
75%    30mar2008      15dec2020
90%    15sep2015      15dec2020       Variance       2.90e+07
95%    15may2018      15dec2020       Skewness       .0012288
99%    15jul2020      15dec2020       Kurtosis         1.7986

                   kidney_transplant_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%    15jul1970      15jan1970
 5%    15aug1972      15jan1970
10%    15jan1975      15jan1970       Obs               6,000
25%    15jun1982      15jan1970       Sum of Wgt.       6,000

50%    30apr1995                      Mean          18may1995
                        Largest       Std. Dev.      5404.567
75%    15jul2008      15dec2020
90%    15nov2015      15dec2020       Variance       2.92e+07
95%    15jun2018      15dec2020       Skewness       .0116625
99%    15may2020      15dec2020       Kurtosis       1.776713

                    other_transplant_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%    15jul1970      15jan1970
 5%    15jun1972      15jan1970
10%    15nov1974      15jan1970       Obs               6,000
25%    15jul1982      15jan1970       Sum of Wgt.       6,000

50%    15jun1995                      Mean          17jul1995
                        Largest       Std. Dev.      5426.728
75%    15aug2008      15nov2020
90%    30jan2016      15nov2020       Variance       2.94e+07
95%    30may2018      15dec2020       Skewness      -.0108833
99%    15may2020      15dec2020       Kurtosis       1.781646

                      hypertension_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%    30jun1970      15jan1970
 5%    15sep1972      15jan1970
10%    15may1975      15jan1970       Obs               6,000
25%    01mar1983      15jan1970       Sum of Wgt.       6,000

50%    15mar1996                      Mean          28jan1996
                        Largest       Std. Dev.      5466.734
75%    15mar2009      15jul2021
90%    15jul2016      15jul2021       Variance       2.99e+07
95%    15mar2019      15jul2021       Skewness      -.0162416
99%    15jan2021      15jul2021       Kurtosis       1.776673

                    ra_sle_psoriasis_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%    15jul1970      15jan1970
 5%    30sep1972      15jan1970
10%    15apr1975      15jan1970       Obs               6,000
25%    15oct1982      15jan1970       Sum of Wgt.       6,000

50%    15jan1995                      Mean          17mar1995
                        Largest       Std. Dev.      5311.398
75%    15aug2007      15dec2020
90%    15jul2015      15dec2020       Variance       2.82e+07
95%    15may2018      15dec2020       Skewness        .031582
99%    15jun2020      15dec2020       Kurtosis       1.821795

                     has_12_m_follow_up
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%           .5              0
10%            1              0       Obs              30,000
25%            1              0       Sum of Wgt.      30,000

50%            1                      Mean                .95
                        Largest       Std. Dev.      .2179486
75%            1              1
90%            1              1       Variance       .0475016
95%            1              1       Skewness      -4.129483
99%            1              1       Kurtosis       18.05263

                   died_ons_covid_flag_any
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%            0              0       Obs              30,000
25%            0              0       Sum of Wgt.      30,000

50%            1                      Mean                 .6
                        Largest       Std. Dev.      .4899061
75%            1              1
90%            1              1       Variance        .240008
95%            1              1       Skewness      -.4082483
99%            1              1       Kurtosis       1.166667

               died_ons_covid_flag_underlying
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%            0              0       Obs              30,000
25%            0              0       Sum of Wgt.      30,000

50%            1                      Mean                 .6
                        Largest       Std. Dev.      .4899061
75%            1              1
90%            1              1       Variance        .240008
95%            1              1       Skewness      -.4082483
99%            1              1       Kurtosis       1.166667

              covid_admission_primary_diagnosis
-------------------------------------------------------------
no observations

                            sgtf
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%            0              0       Obs              27,057
25%            0              0       Sum of Wgt.      27,057

50%            1                      Mean           1.441993
                        Largest       Std. Dev.      2.711345
75%            1              9
90%            9              9       Variance        7.35139
95%            9              9       Skewness       2.334423
99%            9              9       Kurtosis       6.735637

                           lft_pcr
-------------------------------------------------------------
no observations

                             age
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            4              0
10%            8              0       Obs              30,000
25%           21              0       Sum of Wgt.      30,000

50%           40                      Mean            40.3136
                        Largest       Std. Dev.      23.74098
75%           59            106
90%           73            109       Variance       563.6342
95%           79            109       Skewness       .1385349
99%           89            109       Kurtosis       2.055757

                             sex
-------------------------------------------------------------
no observations

                             imd
-------------------------------------------------------------
      Percentiles      Smallest
 1%          100            100
 5%          100            100
10%          100            100       Obs              30,000
25%          200            100       Sum of Wgt.      30,000

50%          300                      Mean           259.0367
                        Largest       Std. Dev.      67.09562
75%          300            300
90%          300            300       Variance       4501.822
95%          300            300       Skewness      -1.366343
99%          300            300       Kurtosis       3.505456

                             stp
-------------------------------------------------------------
no observations

                          ethnicity
-------------------------------------------------------------
      Percentiles      Smallest
 1%            1              1
 5%            1              1
10%            1              1       Obs              27,001
25%            1              1       Sum of Wgt.      27,001

50%            1                      Mean           1.591682
                        Largest       Std. Dev.      1.272665
75%            1              5
90%            3              5       Variance       1.619677
95%            5              5       Skewness       1.941953
99%            5              5       Kurtosis       5.242915

                        household_id
-------------------------------------------------------------
      Percentiles      Smallest
 1%          533            131
 5%          671            202
10%          742            219       Obs              30,000
25%          864            223       Sum of Wgt.      30,000

50%          998                      Mean           998.9465
                        Largest       Std. Dev.      200.5397
75%         1134           1732
90%         1257           1748       Variance       40216.16
95%         1331           1750       Skewness       .0075469
99%         1467           1756       Kurtosis       2.990699

                       household_size
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            1              0
10%            1              0       Obs              30,000
25%            2              0       Sum of Wgt.      30,000

50%            3                      Mean             2.5054
                        Largest       Std. Dev.       1.03795
75%            3              6
90%            4              6       Variance        1.07734
95%            4              6       Skewness       .0270956
99%            5              7       Kurtosis       2.923692

                       care_home_type
-------------------------------------------------------------
no observations

                             bmi
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0      -18.47538
 5%            0      -17.86537
10%     8.779947      -12.67431       Obs              30,000
25%     16.95817      -12.41087       Sum of Wgt.      30,000

50%     24.36458                      Mean           23.72453
                        Largest       Std. Dev.      11.15892
75%     31.26305       62.40468
90%     37.41232       62.82501       Variance       124.5214
95%     41.08676        63.5267       Skewness      -.2301763
99%     48.05092       66.41167       Kurtosis       2.940252

                           bp_sys
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%     37.19767              0
10%      103.701              0       Obs              30,000
25%     111.8568              0       Sum of Wgt.      30,000

50%     119.2591                      Mean           113.9661
                        Largest       Std. Dev.      27.92571
75%     126.3119        158.347
90%     132.6112       160.5135       Variance       779.8452
95%     136.3295        160.924       Skewness      -3.309279
99%     143.1005       165.4064       Kurtosis       13.95506

                           bp_dias
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%     18.74536              0
10%     63.65996              0       Obs              30,000
25%     71.92721              0       Sum of Wgt.      30,000

50%     79.31947                      Mean           75.96064
                        Largest       Std. Dev.      19.97512
75%     86.32917       115.8208
90%     92.49216       118.1947       Variance       399.0054
95%     96.04339       118.9856       Skewness      -2.601422
99%     103.0303       121.6507       Kurtosis       10.69392

                         creatinine
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0      -1.173948
 5%            0              0
10%     35.75795              0       Obs              30,000
25%     47.99059              0       Sum of Wgt.      30,000

50%     58.89628                      Mean           57.03136
                        Largest       Std. Dev.      19.63921
75%     69.49459       115.1573
90%     78.98972        115.642       Variance       385.6985
95%     84.45036       118.3773       Skewness      -.9518232
99%     95.27314       125.0101       Kurtosis       4.616352

                       smoking_status
-------------------------------------------------------------
no observations

                        diabetes_type
-------------------------------------------------------------
no observations

                     hba1c_mmol_per_mol
-------------------------------------------------------------
      Percentiles      Smallest
 1%    -5.652099      -39.83994
 5%            0      -34.79729
10%     7.723421      -34.55836       Obs              30,000
25%     23.72075      -32.44259       Sum of Wgt.      30,000

50%     38.90331                      Mean             38.151
                        Largest       Std. Dev.       21.4604
75%     52.95367       108.4717
90%     65.38563       109.0502       Variance       460.5487
95%     72.77292       112.0714       Skewness      -.0490592
99%     86.67536       112.1661       Kurtosis       2.706307

                      hba1c_percentage
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0       -2.93939
 5%            0      -2.306491
10%     1.760994      -2.143156       Obs              30,000
25%     3.363613      -2.125797       Sum of Wgt.      30,000

50%     4.857239                      Mean            4.73204
                        Largest       Std. Dev.      2.226764
75%     6.246756       12.33014
90%     7.488803       12.52306       Variance        4.95848
95%     8.204093       12.64771       Skewness      -.2192276
99%     9.535055       12.77763       Kurtosis       2.894051

                           asthma
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            0              0
10%            0              0       Obs               6,000
25%            0              0       Sum of Wgt.       6,000

50%            0                      Mean           .7128333
                        Largest       Std. Dev.      .9039754
75%            2              2
90%            2              2       Variance       .8171715
95%            2              2       Skewness       .5963161
99%            2              2       Kurtosis       1.489487

                         patient_id
-------------------------------------------------------------
      Percentiles      Smallest
 1%       2912.5              2
 5%        14848              9
10%        29927             22       Obs              30,000
25%        75304             23       Sum of Wgt.      30,000

50%       150497                      Mean           150341.2
                        Largest       Std. Dev.       86676.7
75%       225624         299938
90%       270113         299954       Variance       7.51e+09
95%     285194.5         299965       Skewness      -.0078825
99%     297085.5         299966       Kurtosis       1.798901

                        diabetes_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%    15may1970      15jan1970
 5%    15mar1972      15jan1970
10%    15mar1975      15jan1970       Obs               1,436
25%    15jan1983      15jan1970       Sum of Wgt.       1,436

50%    15nov1995                      Mean          09jul1995
                        Largest       Std. Dev.      5347.398
75%    30mar2008      15nov2020
90%    15oct2015      15nov2020       Variance       2.86e+07
95%    15may2018      15nov2020       Skewness      -.0086509
99%    15jul2020      15dec2020       Kurtosis        1.83007

                       covid_icu_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%    23dec2020      21dec2020
 5%    01jan2021      21dec2020
10%    12jan2021      21dec2020       Obs              24,001
25%    14feb2021      21dec2020       Sum of Wgt.      24,001

50%    10apr2021                      Mean          09apr2021
                        Largest       Std. Dev.      62.91164
75%    03jun2021      27jul2021
90%    05jul2021      27jul2021       Variance       3957.875
95%    17jul2021      27jul2021       Skewness      -.0053712
99%    25jul2021      27jul2021       Kurtosis       1.810554

                  positive_covid_test_ever
-------------------------------------------------------------
      Percentiles      Smallest
 1%    10apr2021      30jan2021
 5%    22may2021      03feb2021
10%    07jun2021      13feb2021       Obs               6,000
25%    27jun2021      16feb2021       Sum of Wgt.       6,000

50%    12jul2021                      Mean          05jul2021
                        Largest       Std. Dev.      22.35381
75%    21jul2021      27jul2021
90%    25jul2021      27jul2021       Variance        499.693
95%    26jul2021      27jul2021       Skewness      -2.023422
99%    27jul2021      27jul2021       Kurtosis       8.737659

                  covid_tpp_codes_clinical
-------------------------------------------------------------
      Percentiles      Smallest
 1%    23dec2020      21dec2020
 5%    31dec2020      21dec2020
10%    11jan2021      21dec2020       Obs              15,000
25%    13feb2021      21dec2020       Sum of Wgt.      15,000

50%    10apr2021                      Mean          09apr2021
                        Largest       Std. Dev.       63.5175
75%    03jun2021      27jul2021
90%    06jul2021      27jul2021       Variance       4034.473
95%    17jul2021      27jul2021       Skewness       -.015765
99%    25jul2021      27jul2021       Kurtosis       1.784545

                    covid_tpp_codes_test
-------------------------------------------------------------
      Percentiles      Smallest
 1%    23dec2020      21dec2020
 5%    01jan2021      21dec2020
10%    12jan2021      21dec2020       Obs              15,000
25%    14feb2021      21dec2020       Sum of Wgt.      15,000

50%    10apr2021                      Mean          09apr2021
                        Largest       Std. Dev.      62.92539
75%    02jun2021      27jul2021
90%    04jul2021      27jul2021       Variance       3959.604
95%    16jul2021      27jul2021       Skewness      -.0145757
99%    25jul2021      27jul2021       Kurtosis       1.799216

                     covid_tpp_codes_seq
-------------------------------------------------------------
      Percentiles      Smallest
 1%    23dec2020      21dec2020
 5%    31dec2020      21dec2020
10%    11jan2021      21dec2020       Obs              15,000
25%    13feb2021      21dec2020       Sum of Wgt.      15,000

50%    09apr2021                      Mean          09apr2021
                        Largest       Std. Dev.      63.27743
75%    03jun2021      27jul2021
90%    05jul2021      27jul2021       Variance       4004.033
95%    16jul2021      27jul2021       Skewness      -.0097643
99%    25jul2021      27jul2021       Kurtosis       1.801367

                        died_date_ons
-------------------------------------------------------------
      Percentiles      Smallest
 1%    23dec2020      21dec2020
 5%    31dec2020      21dec2020
10%    11jan2021      21dec2020       Obs              24,001
25%    13feb2021      21dec2020       Sum of Wgt.      24,001

50%    08apr2021                      Mean          08apr2021
                        Largest       Std. Dev.      63.16735
75%    01jun2021      27jul2021
90%    06jul2021      27jul2021       Variance       3990.114
95%    17jul2021      27jul2021       Skewness       .0163188
99%    25jul2021      27jul2021       Kurtosis       1.812924

                    covid_admission_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%    22dec2020      20dec2020
 5%    31dec2020      20dec2020
10%    11jan2021      20dec2020       Obs              13,275
25%    13feb2021      20dec2020       Sum of Wgt.      13,275

50%    10apr2021                      Mean          09apr2021
                        Largest       Std. Dev.      63.58522
75%    04jun2021      27jul2021
90%    06jul2021      27jul2021       Variance        4043.08
95%    17jul2021      27jul2021       Skewness      -.0218986
99%    25jul2021      27jul2021       Kurtosis        1.79413

                     covid_tpp_probable
-------------------------------------------------------------
      Percentiles      Smallest
 1%    23dec2020      21dec2020
 5%    01jan2021      21dec2020
10%    12jan2021      21dec2020       Obs              28,817
25%    14feb2021      21dec2020       Sum of Wgt.      28,817

50%    11apr2021                      Mean          10apr2021
                        Largest       Std. Dev.      63.70093
75%    05jun2021      27jul2021
90%    07jul2021      27jul2021       Variance       4057.809
95%    18jul2021      27jul2021       Skewness      -.0135615
99%    25jul2021      27jul2021       Kurtosis       1.785557

                       covid_vacc_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%    11dec2020      09dec2020
 5%    20dec2020      09dec2020
10%    31dec2020      09dec2020       Obs              15,000
25%    02feb2021      09dec2020       Sum of Wgt.      15,000

50%    29mar2021                      Mean          28mar2021
                        Largest       Std. Dev.      63.46417
75%    22may2021      16jul2021
90%    24jun2021      16jul2021       Variance       4027.701
95%    05jul2021      16jul2021       Skewness      -.0076907
99%    15jul2021      16jul2021       Kurtosis        1.80191

                 covid_vacc_second_dose_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%    31dec2020      30dec2020
 5%    08jan2021      30dec2020
10%    19jan2021      30dec2020       Obs               9,000
25%    17feb2021      30dec2020       Sum of Wgt.       9,000

50%    06apr2021                      Mean          07apr2021
                        Largest       Std. Dev.      57.41862
75%    27may2021      16jul2021
90%    26jun2021      16jul2021       Variance       3296.898
95%    06jul2021      16jul2021       Skewness       .0171254
99%    14jul2021      16jul2021       Kurtosis       1.796454

                covid_admission_primary_date
-------------------------------------------------------------
      Percentiles      Smallest
 1%        22271          22269
 5%        22280          22269
10%        22292          22269       Obs               6,676
25%        22324          22269       Sum of Wgt.       6,676

50%        22380                      Mean           22379.37
                        Largest       Std. Dev.      63.35667
75%        22435          22488
90%        22467          22488       Variance       4014.067
95%        22478          22488       Skewness      -.0006616
99%        22486          22488       Kurtosis       1.798144

                covid_primary_care_codes_only
-------------------------------------------------------------
      Percentiles      Smallest
 1%    23dec2020      21dec2020
 5%    01jan2021      21dec2020
10%    12jan2021      21dec2020       Obs              28,500
25%    13feb2021      21dec2020       Sum of Wgt.      28,500

50%    09apr2021                      Mean          09apr2021
                        Largest       Std. Dev.      63.34902
75%    04jun2021      27jul2021
90%    06jul2021      27jul2021       Variance       4013.098
95%    17jul2021      27jul2021       Skewness      -.0014167
99%    25jul2021      27jul2021       Kurtosis       1.794158

. 
. 
. /* CREATE VARIABLES==========================================================
> =*/
. 
. /* DEMOGRAPHICS */ 
. 
. * Sex
. gen male = 1 if sex == "M"
(15,286 missing values generated)

. replace male = 0 if sex == "F"
(15,286 real changes made)

. 
. * Ethnicity 
. replace ethnicity = .u if ethnicity == .
(2,999 real changes made, 2,999 to missing)

. 
. label define ethnicity  1 "White"                                       ///
>                                                 2 "Mixed"                    
>                    ///
>                                                 3 "Asian or Asian British"   
>    ///
>                                                 4 "Black"                    
>                    ///
>                                                 5 "Other"                    
>                    ///
>                                                 .u "Unknown"

. 
. label values ethnicity ethnicity

. 
. * STP 
. rename stp stp_old

. bysort stp_old: gen stp = 1 if _n==1
(29,990 missing values generated)

. replace stp = sum(stp)
(29,999 real changes made)

. drop stp_old

. 
. /*  IMD  */
. * Group into 5 groups
. rename imd imd_o

. egen imd = cut(imd_o), group(5) icodes

. 
. * add one to create groups 1 - 5 
. replace imd = imd + 1
(30,000 real changes made)

. 
. * - 1 is missing, should be excluded from population 
. replace imd = .u if imd_o == -1
(0 real changes made)

. drop imd_o

. 
. * Reverse the order (so high is more deprived)
. recode imd 5 = 1 4 = 2 3 = 3 2 = 4 1 = 5 .u = .u
(imd: 30000 changes made)

. 
. label define imd 1 "1 least deprived" 2 "2" 3 "3" 4 "4" 5 "5 most deprived" .
> u "Unknown"

. label values imd imd 

. 
. /*  Age variables  */ 
. 
. * Create categorised age 
. recode age 18/29.9999 = 1 /// 
>                    30/39.9999 = 2 /// 
>            40/49.9999 = 3 ///
>                    50/59.9999 = 4 ///
>                60/69.9999 = 5 ///
>                    70/79.9999 = 6 ///
>                    80/max = 7, gen(agegroup) 
(23702 differences between age and agegroup)

. 
. label define agegroup   1 "18-<30" ///
>                                                 2 "30-<40" ///
>                                                 3 "40-<50" ///
>                                                 4 "50-<60" ///
>                                                 5 "60-<70" ///
>                                                 6 "70-<80" ///
>                                                 7 "80+"

.                                                 
. label values agegroup agegroup

. 
. * Create binary age (for age stratification)
. recode age min/65.999999999 = 0 ///
>            66/max = 1, gen(age66)
(29669 differences between age and age66)

. 
. * Check there are no missing ages
. assert age < .

. assert agegroup < .

. assert age66 < .

. 
. 
. /* APPLY HH level INCLUSION/EXCLUIONS========================================
> ==========*/ 
. 
. noi di "DROP if HH ID==0"
DROP if HH ID==0

. count if household_id==0
  0

. drop if household_id==0
(0 observations deleted)

. count
  30,000

. 
. drop if care_home_type!="U"
(882 observations deleted)

. count
  29,118

. 
. noi di "DROP HH>=10 persons:"
DROP HH>=10 persons:

. sum household_size, d

                       household_size
-------------------------------------------------------------
      Percentiles      Smallest
 1%            0              0
 5%            1              0
10%            1              0       Obs              29,118
25%            2              0       Sum of Wgt.      29,118

50%            3                      Mean           2.504739
                        Largest       Std. Dev.      1.037883
75%            3              6
90%            4              6       Variance         1.0772
95%            4              6       Skewness       .0268966
99%            5              7       Kurtosis       2.922417

. drop if household_size>=10
(0 observations deleted)

. count
  29,118

. 
. noi di "DROP AGE MISSING:"
DROP AGE MISSING:

. recode age .=9
(age: 0 changes made)

. recode age .u=9
(age: 0 changes made)

. bysort household_id: egen age_drop=max(age)

. drop if age_drop==9
(6 observations deleted)

. count
  29,112

. 
. **************************** HOUSEHOLD VARS**********************************
> *********
. ***KIDS_CAT5 (5 categories)
. *Identify kids under 5/5-11/12-18
. gen no_of_kids=1 if age<5
(27,414 missing values generated)

. recode no_of_kids .=2 if age<12
(no_of_kids: 2502 changes made)

. recode no_of_kids .=3 if age<18 
(no_of_kids: 1923 changes made)

. 
. *Make seperate files with only kids and household number
. preserve

. keep if age<18
(22,989 observations deleted)

. keep household_id no_of_kids

. *Drop duplicates (i.e. for hh with kids of same age, keep only one)
. duplicates drop

Duplicates in terms of all variables

(3,886 observations deleted)

. *If a hh has >1 record, there must be mixed ages in it: flag these as categor
> y 4
. bysort household_id: replace no_of_kids=4 if _N>1
(2,031 real changes made)

. duplicates drop

Duplicates in terms of all variables

(1,267 observations deleted)

. rename no_of_kids kids_cat5

. save kids_mixed_category, replace
(note: file kids_mixed_category.dta not found)
file kids_mixed_category.dta saved

. restore

. 
. *merge in kids identifier
. merge m:1 household_id using kids_mixed_category, nogen keep(master match)

    Result                           # of obs.
    -----------------------------------------
    not matched                           610
        from master                       610  
        from using                          0  

    matched                            28,502  
    -----------------------------------------

. 
. *label variable
. lab define   kids_cat5 0 none  1 "only <5 years" ///
> 2 "only 5-11" 3 "12-<18" 4 "mixed"

. lab val kids_cat5 kids_cat5

. recode kids_cat5 .=0
(kids_cat5: 610 changes made)

. tab kids_cat5

    kids_cat5 |      Freq.     Percent        Cum.
--------------+-----------------------------------
         none |        610        2.10        2.10
only <5 years |        338        1.16        3.26
    only 5-11 |        845        2.90        6.16
       12-<18 |        368        1.26        7.42
        mixed |     26,951       92.58      100.00
--------------+-----------------------------------
        Total |     29,112      100.00

. drop no_of_kids

. 
. ***KIDS_CAT4 (4 categories)
. *Identify kids under 0-11/12-18
. gen no_of_kids=1 if age<12
(24,912 missing values generated)

. recode no_of_kids .=2 if age<18 
(no_of_kids: 1923 changes made)

. 
. *Make seperate files with only kids and household number
. preserve

. keep if age<18
(22,989 observations deleted)

. keep household_id no_of_kids

. *Drop duplicates (i.e. for hh with kids of same age, keep only one)
. duplicates drop

Duplicates in terms of all variables

(4,473 observations deleted)

. *If a hh has >1 record, there must be mixed ages in it: flag these as categor
> y 4
. bysort household_id: replace no_of_kids=3 if _N>1
(1,360 real changes made)

. duplicates drop

Duplicates in terms of all variables

(680 observations deleted)

. rename no_of_kids kids_cat4

. list in 1/100

     +---------------------+
     | househ~d   kids_c~4 |
     |---------------------|
  1. |      257          1 |
  2. |      312          1 |
  3. |      352          1 |
  4. |      355          1 |
  5. |      394          2 |
     |---------------------|
  6. |      396          1 |
  7. |      423          1 |
  8. |      424          1 |
  9. |      441          3 |
 10. |      447          1 |
     |---------------------|
 11. |      448          1 |
 12. |      451          1 |
 13. |      455          1 |
 14. |      459          1 |
 15. |      460          2 |
     |---------------------|
 16. |      462          1 |
 17. |      476          2 |
 18. |      478          2 |
 19. |      482          2 |
 20. |      485          1 |
     |---------------------|
 21. |      487          1 |
 22. |      490          1 |
 23. |      491          1 |
 24. |      493          1 |
 25. |      495          2 |
     |---------------------|
 26. |      496          1 |
 27. |      497          2 |
 28. |      498          2 |
 29. |      499          1 |
 30. |      507          1 |
     |---------------------|
 31. |      508          1 |
 32. |      509          2 |
 33. |      510          2 |
 34. |      515          3 |
 35. |      516          1 |
     |---------------------|
 36. |      517          2 |
 37. |      518          1 |
 38. |      523          3 |
 39. |      524          1 |
 40. |      529          1 |
     |---------------------|
 41. |      532          1 |
 42. |      534          1 |
 43. |      535          1 |
 44. |      536          1 |
 45. |      538          3 |
     |---------------------|
 46. |      539          1 |
 47. |      541          2 |
 48. |      543          1 |
 49. |      544          1 |
 50. |      545          1 |
     |---------------------|
 51. |      546          1 |
 52. |      548          2 |
 53. |      549          1 |
 54. |      551          1 |
 55. |      552          1 |
     |---------------------|
 56. |      554          2 |
 57. |      555          1 |
 58. |      556          3 |
 59. |      557          2 |
 60. |      558          2 |
     |---------------------|
 61. |      560          1 |
 62. |      562          3 |
 63. |      563          1 |
 64. |      564          1 |
 65. |      565          1 |
     |---------------------|
 66. |      566          1 |
 67. |      568          1 |
 68. |      569          3 |
 69. |      570          1 |
 70. |      571          3 |
     |---------------------|
 71. |      575          1 |
 72. |      576          1 |
 73. |      577          1 |
 74. |      578          1 |
 75. |      579          2 |
     |---------------------|
 76. |      581          3 |
 77. |      582          3 |
 78. |      583          1 |
 79. |      584          1 |
 80. |      585          1 |
     |---------------------|
 81. |      586          1 |
 82. |      587          1 |
 83. |      588          3 |
 84. |      589          1 |
 85. |      590          1 |
     |---------------------|
 86. |      592          1 |
 87. |      593          1 |
 88. |      594          1 |
 89. |      596          3 |
 90. |      597          3 |
     |---------------------|
 91. |      598          3 |
 92. |      599          2 |
 93. |      602          3 |
 94. |      603          2 |
 95. |      604          3 |
     |---------------------|
 96. |      605          3 |
 97. |      606          1 |
 98. |      607          1 |
 99. |      608          1 |
100. |      609          3 |
     +---------------------+

. save kids_mixed_category, replace
file kids_mixed_category.dta saved

. restore

. 
. *merge in kids identifier
. merge m:1 household_id using kids_mixed_category, nogen keep(master match)

    Result                           # of obs.
    -----------------------------------------
    not matched                           610
        from master                       610  
        from using                          0  

    matched                            28,502  
    -----------------------------------------

. 
. *label variable
. lab define   kids_cat4 0 none  1 "only <12 years" ///
> 2 "only 12-18" ///
> 3 "mixed"

. lab val kids_cat4 kids_cat4

. recode kids_cat4 .=0
(kids_cat4: 610 changes made)

. tab kids_cat4

     kids_cat4 |      Freq.     Percent        Cum.
---------------+-----------------------------------
          none |        610        2.10        2.10
only <12 years |      2,929       10.06       12.16
    only 12-18 |        368        1.26       13.42
         mixed |     25,205       86.58      100.00
---------------+-----------------------------------
         Total |     29,112      100.00

. 
. *Dose-response exposure: identify number of kids in hh where there are ONLY u
> nder 11 yr olds
. bysort household_id: egen number_kids=sum(no_of_kids) if kids_cat4==1
(26183 missing values generated)

. 
. gen gp_number_kids=number_kids
(26,183 missing values generated)

. recode gp_number_kids 4/max=4
(gp_number_kids: 861 changes made)

. 
. lab var gp_number_kids "Number kids under 12 years in hh"

. lab define   gp_number_kids 0 none ///
> 1 "1 child <12" ///
> 2 "2 children <12" ///
> 3 "3 children <12" ///
> 4 "4+ children <12"

. lab val gp_number_kids gp_number_kids

. 
. tab kids_cat4 

     kids_cat4 |      Freq.     Percent        Cum.
---------------+-----------------------------------
          none |        610        2.10        2.10
only <12 years |      2,929       10.06       12.16
    only 12-18 |        368        1.26       13.42
         mixed |     25,205       86.58      100.00
---------------+-----------------------------------
         Total |     29,112      100.00

. tab kids_cat5

    kids_cat5 |      Freq.     Percent        Cum.
--------------+-----------------------------------
         none |        610        2.10        2.10
only <5 years |        338        1.16        3.26
    only 5-11 |        845        2.90        6.16
       12-<18 |        368        1.26        7.42
        mixed |     26,951       92.58      100.00
--------------+-----------------------------------
        Total |     29,112      100.00

. tab kids_cat*

              |                  kids_cat4
    kids_cat5 |      none  only <12   only 12-1      mixed |     Total
--------------+--------------------------------------------+----------
         none |       610          0          0          0 |       610 
only <5 years |         0        338          0          0 |       338 
    only 5-11 |         0        845          0          0 |       845 
       12-<18 |         0          0        368          0 |       368 
        mixed |         0      1,746          0     25,205 |    26,951 
--------------+--------------------------------------------+----------
        Total |       610      2,929        368     25,205 |    29,112 

. 
. 
. /* DROP ALL KIDS, AS HH COMPOSITION VARS ARE NOW MADE */
. drop if age<18
(6,123 observations deleted)

. 
. *Total number adults in household (to check hh size)
. bysort household_id: gen tot_adults_hh=_N

. recode tot_adults_hh 3/max=3
(tot_adults_hh: 22521 changes made)

. 
. tab kids_cat4

     kids_cat4 |      Freq.     Percent        Cum.
---------------+-----------------------------------
          none |        610        2.65        2.65
only <12 years |      2,390       10.40       13.05
    only 12-18 |        296        1.29       14.34
         mixed |     19,693       85.66      100.00
---------------+-----------------------------------
         Total |     22,989      100.00

. tab gp_num if kids_cat4==1

    Number kids |
 under 12 years |
          in hh |      Freq.     Percent        Cum.
----------------+-----------------------------------
    1 child <12 |        479       20.04       20.04
 2 children <12 |        527       22.05       42.09
 3 children <12 |        369       15.44       57.53
4+ children <12 |      1,015       42.47      100.00
----------------+-----------------------------------
          Total |      2,390      100.00

. 
. erase kids_mixed_category.dta

. 
. /* SET FU DATES==============================================================
> =*/ 
. * Censoring dates for each outcome (largely, last date outcome data available
> )
. *****NEEDS UPDATING WHEN INFO AVAILABLE*******************
. 
. * Note - outcome dates are handled separtely below 
. 
. * Some names too long for loops below, shorten
. rename permanent_immunodeficiency_date  perm_immunodef_date

. rename temporary_immunodeficiency_date  temp_immunodef_date

. rename bmi_date_measured_date                   bmi_measured_date

. rename dereg_date_date                                          dereg_date

. 
. /* CREATE BINARY VARIABLES===================================================
> =*/
. *  Make indicator variables for all conditions where relevant 
. 
. foreach var of varlist  chronic_respiratory_disease ///
>                                                 chronic_cardiac_disease  ///
>                                                 diabetes_date  ///
>                                                 cancer_haem  ///
>                                                 cancer_nonhaem  ///
>                                                 perm_immunodef  ///
>                                                 temp_immunodef  ///
>                                                 dialysis                     
>                    ///
>                                                 kidney_transplant            
>            ///
>                                                 other_transplant             
>            /// 
>                                                 asplenia                     
>    /// 
>                                                 chronic_liver_disease  ///
>                                                 other_neuro  ///
>                                                 stroke_dementia              
>            ///
>                                                 esrf  ///
>                                                 hypertension  ///
>                                                 ra_sle_psoriasis  ///
>                                                 bmi_measured_date   ///
>                                                 bp_sys_date_measured   ///
>                                                 bp_dias_date_measured   ///
>                                                 creatinine_date  ///
>                                                 smoking_status_date ///
>                                                 {
  2.                                                 
.         /* date ranges are applied in python, so presence of date indicates p
> resence of 
>           disease in the correct time frame */ 
.         local newvar =  substr("`var'", 1, length("`var'") - 5)
  3.         gen `newvar' = (`var'!=. )
  4.         order `newvar', after(`var')
  5.         
. }

. 
. 
. 
. 
. /*  Body Mass Index  */
. * NB: watch for missingness
. 
. * Recode strange values 
. replace bmi = . if bmi == 0 
(1,138 real changes made, 1,138 to missing)

. replace bmi = . if !inrange(bmi, 15, 50)
(3,592 real changes made, 3,592 to missing)

. 
. * Restrict to within 10 years of index and aged > 16 
. gen bmi_time = (date("$indexdate", "DMY") - bmi_measured_date)/365.25
(1,138 missing values generated)

. gen bmi_age = age - bmi_time
(1,138 missing values generated)

. 
. replace bmi = . if bmi_age < 16 
(423 real changes made, 423 to missing)

. replace bmi = . if bmi_time > 10 & bmi_time != . 
(0 real changes made)

. 
. * Set to missing if no date, and vice versa 
. replace bmi = . if bmi_measured_date == . 
(0 real changes made)

. replace bmi_measured_date = . if bmi == . 
(4,015 real changes made, 4,015 to missing)

. replace bmi_measured = . if bmi == . 
(5,153 real changes made, 5,153 to missing)

. 
. gen     bmicat = .
(22,989 missing values generated)

. recode  bmicat . = 1 if bmi < 18.5
(bmicat: 2113 changes made)

. recode  bmicat . = 2 if bmi < 25
(bmicat: 5158 changes made)

. recode  bmicat . = 3 if bmi < 30
(bmicat: 4096 changes made)

. recode  bmicat . = 4 if bmi < 35
(bmicat: 3177 changes made)

. recode  bmicat . = 5 if bmi < 40
(bmicat: 2044 changes made)

. recode  bmicat . = 6 if bmi < .
(bmicat: 1248 changes made)

. replace bmicat = .u if bmi >= .
(5,153 real changes made, 5,153 to missing)

. 
. label define bmicat 1 "Underweight (<18.5)"     ///
>                                         2 "Normal (18.5-24.9)"          ///
>                                         3 "Overweight (25-29.9)"        ///
>                                         4 "Obese I (30-34.9)"           ///
>                                         5 "Obese II (35-39.9)"          ///
>                                         6 "Obese III (40+)"                  
>    ///
>                                         .u "Unknown (.u)"

.                                         
. label values bmicat bmicat

. 
. * Create less  granular categorisation
. recode bmicat 1/3 .u = 1 4 = 2 5 = 3 6 = 4, gen(obese4cat)
(20876 differences between bmicat and obese4cat)

. 
. label define obese4cat  1 "No record of obesity"        ///
>                                                 2 "Obese I (30-34.9)"        
>    ///
>                                                 3 "Obese II (35-39.9)"       
>    ///
>                                                 4 "Obese III (40+)"          
>    

. 
. label values obese4cat obese4cat

. order obese4cat, after(bmicat)

. 
. 
. /*  Smoking  */
. 
. * Smoking 
. label define smoke 1 "Never" 2 "Former" 3 "Current" .u "Unknown (.u)"

. 
. gen     smoke = 1  if smoking_status == "N"
(22,067 missing values generated)

. replace smoke = 2  if smoking_status == "E"
(458 real changes made)

. replace smoke = 3  if smoking_status == "S"
(2,732 real changes made)

. replace smoke = .u if smoking_status == "M"
(503 real changes made, 503 to missing)

. replace smoke = .u if smoking_status == "" 
(18,374 real changes made, 18,374 to missing)

. 
. label values smoke smoke

. drop smoking_status

. 
. * Create non-missing 3-category variable for current smoking
. * Assumes missing smoking is never smoking 
. recode smoke .u = 1, gen(smoke_nomiss)
(18877 differences between smoke and smoke_nomiss)

. order smoke_nomiss, after(smoke)

. label values smoke_nomiss smoke

. 
. /* CLINICAL COMORBIDITIES */ 
. 
. /*  Cancer */
. label define cancer 1 "Never" 2 "Last year" 3 "2-5 years ago" 4 "5+ years"

. 
. * Haematological malignancies
. gen     cancer_haem_cat = 4 if inrange(cancer_haem_date, d(1/1/1900), d(1/2/2
> 015))
(18,956 missing values generated)

. replace cancer_haem_cat = 3 if inrange(cancer_haem_date, d(1/2/2015), d(1/2/2
> 019))
(374 real changes made)

. replace cancer_haem_cat = 2 if inrange(cancer_haem_date, d(1/2/2019), d(1/2/2
> 020))
(94 real changes made)

. recode  cancer_haem_cat . = 1
(cancer_haem_cat: 18488 changes made)

. label values cancer_haem_cat cancer

. 
. 
. * All other cancers
. gen     cancer_exhaem_cat = 4 if inrange(cancer_nonhaem_date,  d(1/1/1900), d
> (1/2/2015)) 
(18,998 missing values generated)

. replace cancer_exhaem_cat = 3 if inrange(cancer_nonhaem_date,  d(1/2/2015), d
> (1/2/2019))
(389 real changes made)

. replace cancer_exhaem_cat = 2 if inrange(cancer_nonhaem_date,  d(1/2/2019), d
> (1/2/2020)) 
(102 real changes made)

. recode  cancer_exhaem_cat . = 1
(cancer_exhaem_cat: 18507 changes made)

. label values cancer_exhaem_cat cancer

. 
. 
. /*  Immunosuppression  */
. 
. * Immunosuppressed:
. * Permanent immunodeficiency ever, OR 
. * Temporary immunodeficiency  last year
. gen temp1  = 1 if perm_immunodef_date!=.
(18,423 missing values generated)

. gen temp2  = inrange(temp_immunodef_date, (date("$indexdate", "DMY") - 365), 
> date("$indexdate", "DMY"))

. 
. egen other_immuno = rowmax(temp1 temp2)

. drop temp1 temp2 

. order other_immuno, after(temp_immunodef)

. 
. /*  Blood pressure   */
. 
. * Categorise
. gen     bpcat = 1 if bp_sys < 120 &  bp_dias < 80
(16,641 missing values generated)

. replace bpcat = 2 if inrange(bp_sys, 120, 130) & bp_dias<80
(3,935 real changes made)

. replace bpcat = 3 if inrange(bp_sys, 130, 140) | inrange(bp_dias, 80, 90)
(9,505 real changes made)

. replace bpcat = 4 if (bp_sys>=140 & bp_sys<.) | (bp_dias>=90 & bp_dias<.) 
(3,864 real changes made)

. replace bpcat = .u if bp_sys>=. | bp_dias>=. | bp_sys==0 | bp_dias==0
(2,276 real changes made, 2,276 to missing)

. 
. label define bpcat 1 "Normal" 2 "Elevated" 3 "High, stage I"    ///
>                                         4 "High, stage II" .u "Unknown"

. label values bpcat bpcat

. 
. recode bpcat .u=1, gen(bpcat_nomiss)
(2276 differences between bpcat and bpcat_nomiss)

. label values bpcat_nomiss bpcat

. 
. * Create non-missing indicator of known high blood pressure
. gen bphigh = (bpcat==4)

. 
. /*  Hypertension  */
. 
. gen htdiag_or_highbp = bphigh

. recode htdiag_or_highbp 0 = 1 if hypertension==1 
(htdiag_or_highbp: 3885 changes made)

. 
. 
. ************
. *   eGFR   *
. ************
. 
. * Set implausible creatinine values to missing (Note: zero changed to missing
> )
. replace creatinine = . if !inrange(creatinine, 20, 3000) 
(1,196 real changes made, 1,196 to missing)

.         
. * Divide by 88.4 (to convert umol/l to mg/dl)
. gen SCr_adj = creatinine/88.4
(1,196 missing values generated)

. 
. gen min=.
(22,989 missing values generated)

. replace min = SCr_adj/0.7 if male==0
(11,126 real changes made)

. replace min = SCr_adj/0.9 if male==1
(10,667 real changes made)

. replace min = min^-0.329  if male==0
(11,126 real changes made)

. replace min = min^-0.411  if male==1
(10,667 real changes made)

. replace min = 1 if min<1
(5,959 real changes made)

. 
. gen max=.
(22,989 missing values generated)

. replace max=SCr_adj/0.7 if male==0
(11,126 real changes made)

. replace max=SCr_adj/0.9 if male==1
(10,667 real changes made)

. replace max=max^-1.209
(21,793 real changes made)

. replace max=1 if max>1
(17,030 real changes made)

. 
. gen egfr=min*max*141
(1,196 missing values generated)

. replace egfr=egfr*(0.993^age)
(21,793 real changes made)

. replace egfr=egfr*1.018 if male==0
(11,126 real changes made)

. label var egfr "egfr calculated using CKD-EPI formula with no eth"

. 
. * Categorise into ckd stages
. egen egfr_cat = cut(egfr), at(0, 15, 30, 45, 60, 5000)
(1196 missing values generated)

. recode egfr_cat 0=5 15=4 30=3 45=2 60=0, generate(ckd)
(21793 differences between egfr_cat and ckd)

. * 0 = "No CKD"  2 "stage 3a" 3 "stage 3b" 4 "stage 4" 5 "stage 5"
. label define ckd 0 "No CKD" 1 "CKD"

. label values ckd ckd

. *label var ckd "CKD stage calc without eth"
. 
. * Convert into CKD group
. *recode ckd 2/5=1, gen(chronic_kidney_disease)
. *replace chronic_kidney_disease = 0 if creatinine==. 
.         
. recode ckd 0=1 2/3=2 4/5=3, gen(reduced_kidney_function_cat)
(21529 differences between ckd and reduced_kidney_function_cat)

. replace reduced_kidney_function_cat = 1 if creatinine==. 
(1,196 real changes made)

. label define reduced_kidney_function_catlab ///
>         1 "None" 2 "Stage 3a/3b egfr 30-60      " 3 "Stage 4/5 egfr<30"

. label values reduced_kidney_function_cat reduced_kidney_function_catlab 

. lab var  reduced "Reduced kidney function"

. 
. 
. /*ESDR: dialysis or kidney transplant*/
. gen esrd=1 if dialysis==1 | kidney_transplant==1
(14,691 missing values generated)

. recode esrd .=0
(esrd: 14691 changes made)

. 
. 
. 
. ***************************
. /* DM / Hb1AC */
. ***************************
. 
. 
. /*  Diabetes severity  */
. 
. * Set zero or negative to missing
. replace hba1c_percentage   = . if hba1c_percentage <= 0
(1,297 real changes made, 1,297 to missing)

. replace hba1c_mmol_per_mol = . if hba1c_mmol_per_mol <= 0
(1,594 real changes made, 1,594 to missing)

. 
. /* Express  HbA1c as percentage  */ 
. 
. * Express all values as perecentage 
. noi summ hba1c_percentage hba1c_mmol_per_mol 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
hba1c_per~ge |     21,692    5.019464    1.956656   .0000974   12.77763
hba1c_mmol~l |     21,395    41.22155    19.02412   .0085653   112.0714

. gen     hba1c_pct = hba1c_percentage 
(1,297 missing values generated)

. replace hba1c_pct = (hba1c_mmol_per_mol/10.929)+2.15 if hba1c_mmol_per_mol<. 
(21,395 real changes made)

. 
. * Valid % range between 0-20  /195 mmol/mol
. replace hba1c_pct = . if !inrange(hba1c_pct, 0, 20) 
(0 real changes made)

. replace hba1c_pct = round(hba1c_pct, 0.1)
(22,913 real changes made)

. 
. 
. /* Categorise hba1c and diabetes  */
. /* Diabetes type */
. gen dm_type=1 if diabetes_type=="T1DM"
(22,326 missing values generated)

. replace dm_type=2 if diabetes_type=="T2DM"
(4,520 real changes made)

. replace dm_type=3 if diabetes_type=="UNKNOWN_DM"
(465 real changes made)

. replace dm_type=0 if diabetes_type=="NO_DM"
(17,341 real changes made)

. 
. safetab dm_type diabetes_type
0

           |                diabetes_type
   dm_type |     NO_DM       T1DM       T2DM  UNKNOWN.. |     Total
-----------+--------------------------------------------+----------
         0 |    17,341          0          0          0 |    17,341 
         1 |         0        663          0          0 |       663 
         2 |         0          0      4,520          0 |     4,520 
         3 |         0          0          0        465 |       465 
-----------+--------------------------------------------+----------
     Total |    17,341        663      4,520        465 |    22,989 

. label define dm_type 0"No DM" 1"T1DM" 2"T2DM" 3"UNKNOWN_DM"

. label values dm_type dm_type

. 
. /*Open safely diabetes codes with exeter algorithm
> gen dm_type_exeter_os=1 if diabetes_exeter_os=="T1DM_EX_OS"
> replace dm_type_exeter_os=2 if diabetes_exeter_os=="T2DM_EX_OS"
> replace dm_type_exeter_os=0 if diabetes_exeter_os=="NO_DM"
> label values  dm_type_exeter_os dm_type*/
. 
. * Group hba1c
. gen     hba1ccat = 0 if hba1c_pct <  6.5
(8,454 missing values generated)

. replace hba1ccat = 1 if hba1c_pct >= 6.5  & hba1c_pct < 7.5
(4,049 real changes made)

. replace hba1ccat = 2 if hba1c_pct >= 7.5  & hba1c_pct < 8
(1,442 real changes made)

. replace hba1ccat = 3 if hba1c_pct >= 8    & hba1c_pct < 9
(1,844 real changes made)

. replace hba1ccat = 4 if hba1c_pct >= 9    & hba1c_pct !=.
(1,043 real changes made)

. label define hba1ccat 0 "<6.5%" 1">=6.5-7.4" 2">=7.5-7.9" 3">=8-8.9" 4">=9"

. label values hba1ccat hba1ccat

. safetab hba1ccat
0

   hba1ccat |      Freq.     Percent        Cum.
------------+-----------------------------------
      <6.5% |     14,535       63.44       63.44
  >=6.5-7.4 |      4,049       17.67       81.11
  >=7.5-7.9 |      1,442        6.29       87.40
    >=8-8.9 |      1,844        8.05       95.45
        >=9 |      1,043        4.55      100.00
------------+-----------------------------------
      Total |     22,913      100.00

. 
. gen hba1c75=0 if hba1c_pct<7.5
(4,405 missing values generated)

. replace hba1c75=1 if hba1c_pct>=7.5 & hba1c_pct!=.
(4,329 real changes made)

. label define hba1c75 0"<7.5" 1">=7.5"

. safetab hba1c75, m
8

    hba1c75 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     18,584       80.84       80.84
          1 |      4,329       18.83       99.67
          . |         76        0.33      100.00
------------+-----------------------------------
      Total |     22,989      100.00

. 
. * Create diabetes, split by control/not
. gen     diabcat = 1 if dm_type==0 | dm_type==.
(5,648 missing values generated)

. replace diabcat = 2 if dm_type==1 & inlist(hba1ccat, 0, 1)
(521 real changes made)

. replace diabcat = 3 if dm_type==1 & inlist(hba1ccat, 2, 3, 4)
(142 real changes made)

. replace diabcat = 4 if dm_type==2 & inlist(hba1ccat, 0, 1)
(3,671 real changes made)

. replace diabcat = 5 if dm_type==2 & inlist(hba1ccat, 2, 3, 4)
(837 real changes made)

. replace diabcat = 6 if dm_type==1 & hba1c_pct==. | dm_type==2 & hba1c_pct==.
(12 real changes made)

. 
. 
. label define diabcat    1 "No diabetes"                         ///
>                                                 2 "T1DM, controlled"         
>    ///
>                                                 3 "T1DM, uncontrolled"       
>    ///
>                                                 4 "T2DM, controlled"         
>    ///
>                                                 5 "T2DM, uncontrolled"       
>    ///
>                                                 6 "Diabetes, no HbA1c"

. label values diabcat diabcat

. safetab diabcat, m
8

           diabcat |      Freq.     Percent        Cum.
-------------------+-----------------------------------
       No diabetes |     17,341       75.43       75.43
  T1DM, controlled |        521        2.27       77.70
T1DM, uncontrolled |        142        0.62       78.32
  T2DM, controlled |      3,671       15.97       94.28
T2DM, uncontrolled |        837        3.64       97.93
Diabetes, no HbA1c |         12        0.05       97.98
                 . |        465        2.02      100.00
-------------------+-----------------------------------
             Total |     22,989      100.00

. recode diabcat .=1
(diabcat: 465 changes made)

. 
. 
. 
. /*  Asthma  */
. 
. 
. * Asthma  (coded: 0 No, 1 Yes no OCS, 2 Yes with OCS)
. rename asthma asthmacat

. recode asthmacat 0=1 1=2 2=3
(asthmacat: 4606 changes made)

. label define asthmacat 1 "No" 2 "Yes, no OCS" 3 "Yes with OCS"

. label values asthmacat asthmacat

. 
. gen asthma = (asthmacat==2|asthmacat==3)

. 
. /*  Probable shielding  */
. gen shield=1 if esrd==1 | other_transplant==1 | asthmacat==2 | asthmacat==3 |
>  ///
> chronic_respiratory_disease==1 | cancer_haem==1 | cancer_nonhaem==1 | ///
> asplenia==1 | other_immuno==1
(3,617 missing values generated)

. recode shield .=0
(shield: 3617 changes made)

. 
. /*Any comorbidity*/
. 
. gen anycomorb=1 if chronic_respiratory_disease==1 | ///
>                     asthmacat==2 | asthmacat==3 | ///
>                                         chronic_cardiac_disease==1  | ///
>                                         diabcat==2 | diabcat==3 | diabcat==4 
> | diabcat==5 | diabcat==6 | ///
>                                         cancer_haem==1 | cancer_nonhaem==1 | 
> ///
>                                         esrd==1 | ///
>                                         chronic_liver_disease==1 | ///
>                                         stroke_dementia==1 | ///
>                                         other_neuro==1 | ///
>                                         other_transplant==1 | ///
>                                         asplenia==1 | ///
>                                         ra_sle_psoriasis==1 | ///
>                                         other_immuno==1 
(953 missing values generated)

. recode anycomorb .=0
(anycomorb: 953 changes made)

. tab anyco

  anycomorb |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        953        4.15        4.15
          1 |     22,036       95.85      100.00
------------+-----------------------------------
      Total |     22,989      100.00

. 
. * Comorbidities of interest 
. label var asthma                                                "Asthma categ
> ory"

. label var egfr_cat                                              "Calculated e
> GFR"

. label var hypertension                              "Diagnosed hypertension"

. label var chronic_respiratory_disease   "Chronic Respiratory Diseases"

. label var chronic_cardiac_disease               "Chronic Cardiac Diseases"

. label var diabcat                                               "Diabetes"

. label var cancer_haem_cat                                               "Haem
> atological cancer"

. label var cancer_exhaem_cat                                             "Non-
> haematological cancer"

. label var kidney_transplant                                             "Kidn
> ey transplant"     

. label var other_transplant                                              "Othe
> r solid organ transplant"

. label var asplenia                                              "Asplenia"

. label var other_immuno                                  "Immunosuppressed (co
> mbination algorithm)"

. label var chronic_liver_disease                 "Chronic liver disease"

. label var other_neuro                   "Neurological disease"               
>    

. label var stroke_dementia                           "Stroke or dementia"     
>                                                    

. label var ra_sle_psoriasis                              "Autoimmune disease"

. lab var egfr                                                    eGFR

. lab var perm_immunodef                                  "Permanent immunosupp
> ression"

. lab var temp_immunodef                                  "Temporary immunosupp
> ression"

. lab var esrd                                                    "End-stage re
> nal disease"

. 
. lab var covid_vacc_date                         "First vacc date"

. lab var covid_vacc_second_dose_date "Second vacc date"

. 
. /* OUTCOME AND SURVIVAL TIME=================================================
> =*/
. 
. gen enter_date = date("$indexdate", "DMY")

. gen study_end_censor =date("$study_end_censor", "DMY")

. gen SUS_study_end_censor =date("$SUS_study_end_censor", "DMY")

. 
. * Format the dates
. format  enter_date                                      ///
>                 study_end_censor  

  variable name     display format
  --------------------------------
  enter_date        %9.0g
  study_end_censor  %9.0g
  --------------------------------

.                 
.                         /****   Outcome definitions   ****/
. 
. * Date of Covid death in ONS
. gen died_date_onscovid = died_date_ons if died_ons_covid_flag_any == 1
(11,993 missing values generated)

. gen died_date_onscovid_part1 = died_date_ons if died_ons_covid_flag_underlyin
> g == 1
(11,941 missing values generated)

. 
. * Date of non-COVID death in ONS 
. * If missing date of death resulting died_date will also be missing
. gen died_date_onsnoncovid = died_date_ons if died_ons_covid_flag_any != 1 
(15,565 missing values generated)

. 
. *Date probable covid in TPP
. rename covid_tpp_probable date_covid_tpp_prob

. 
. format died_date_ons %td

. format died_date_onscovid %td 

. format died_date_onsnoncovid %td

. format covid_icu_date %td 

. format died_date_onscovid_part1 %td

. format covid_admission_primary_date %td

. 
. * Binary indicators (0/1) for outcomes
. gen covid_tpp_prob = (date_covid_tpp_prob < .)

. gen non_covid_death = (died_date_onsnoncovid < .)

. gen covid_death = (died_date_onscovid < .)

. gen covid_icu = (covid_icu_date < .)

. gen covidadmission = (covid_admission_primary_date < .)

. gen covid_death_part1 = (died_date_onscovid_part1 < .)

. 
.                                         /**** Create survival times  ****/
. * For looping later, name must be stime_binary_outcome_name
. 
. * Survival time = last followup date (first: end study, death, or that outcom
> e)
. *gen stime_onscoviddeath = min(onscoviddeathcensor_date,                     
>            died_date_ons)
. gen stime_covid_death_part1     = min(study_end_censor   , died_date_onscovid
> _part1, died_date_ons, dereg_date)

. gen stime_covid_tpp_prob = min(study_end_censor   , died_date_ons, date_covid
> _tpp_prob, dereg_date)

. gen stime_non_covid_death = min(study_end_censor   , died_date_ons, died_date
> _onsnoncovid, dereg_date)

. gen stime_covid_death = min(study_end_censor   , died_date_ons, died_date_ons
> covid, dereg_date)

. gen stime_covid_icu = min(study_end_censor, died_date_ons, covid_icu_date, de
> reg_date)

. gen stime_covidadmission        = min(SUS_study_end_censor   , covid_admissio
> n_primary_date, died_date_ons, dereg_date)

. 
. * If outcome was after censoring occurred, set to zero
. replace covid_tpp_prob = 0 if (date_covid_tpp_prob > study_end_censor ) 
(1,235 real changes made)

. replace non_covid_death = 0 if (died_date_onsnoncovid > study_end_censor )
(384 real changes made)

. replace covid_death = 0 if (died_date_onscovid > study_end_censor )
(560 real changes made)

. replace covid_icu = 0 if (covid_icu_date > study_end_censor)
(919 real changes made)

. replace covidadmission  = 0 if (covid_admission_primary_date > SUS_study_end_
> censor  | covid_admission_primary_date > died_date_ons) 
(2,363 real changes made)

. replace covid_death_part1 = 0 if (died_date_onscovid_part1 > study_end_censor
>  )
(572 real changes made)

. 
. * If outcome was after censoring occurred, set date to missing
. replace date_covid_tpp_prob = . if (date_covid_tpp_prob > study_end_censor ) 
(1,235 real changes made, 1,235 to missing)

. replace died_date_onsnoncovid = . if (died_date_onsnoncovid > study_end_censo
> r )
(384 real changes made, 384 to missing)

. replace died_date_onscovid = . if (died_date_onscovid > study_end_censor )
(560 real changes made, 560 to missing)

. replace covid_icu_date = . if (covid_icu_date > study_end_censor)
(919 real changes made, 919 to missing)

. replace covid_admission_primary_date    = . if (covid_admission_primary_date 
> > SUS_study_end_censor  | covid_admission_primary_date > died_date_ons) 
(2,363 real changes made, 2,363 to missing)

. replace died_date_onscovid_part1 = . if (died_date_onscovid_part1 > study_end
> _censor )
(572 real changes made, 572 to missing)

. 
. 
. * Format date variables
. format  stime* %td  

. gen positive_SGSS = (positive_covid_test_ever < .)

. gen covid_primary_care_codes = (covid_primary_care_codes_only < .)

. rename positive_covid_test_ever date_positive_SGSS

. rename covid_primary_care_codes_only date_covid_primary_care_codes

. replace covid_primary_care_codes = 0 if (date_covid_primary_care_codes > stud
> y_end_censor )
(1,132 real changes made)

. replace positive_SGSS = 0 if (date_positive_SGSS > study_end_censor )
(1,816 real changes made)

. 
. replace date_covid_primary_care_codes = . if (date_covid_primary_care_codes >
>  study_end_censor )
(1,132 real changes made, 1,132 to missing)

. replace date_positive_SGSS = . if (date_positive_SGSS > study_end_censor )
(1,816 real changes made, 1,816 to missing)

. 
. 
. gen reported_infection_source=1 if covid_tpp_prob==1
(2,146 missing values generated)

. recode reported_infection_source 1=2 if date_covid_tpp_prob== covid_tpp_codes
> _test 
(reported_infection_source: 50 changes made)

. recode reported_infection_source 1=3 if date_covid_tpp_prob==covid_tpp_codes_
> seq 
(reported_infection_source: 46 changes made)

. recode reported_infection_source 1=4 if date_covid_tpp_prob==covid_tpp_codes_
> clinical 
(reported_infection_source: 52 changes made)

. lab define reported_infection_source 1 SGSS 2 test_code 3 sequalae_code 4 dia
> gnosis_code

. lab val reported_infection_source reported_infection_source

. 
. 
. 
. 
. /* LABEL VARIABLES===========================================================
> =*/
. *  Label variables you are intending to keep, drop the rest 
. 
. *HH variable
. label var  number_kids "Number of children aged 1-<12 years in household"

. label var  household_size "Number people in household"

. label var  household_id "Household ID"

. 
. 
. * Demographics
. label var patient_id                            "Patient ID"

. label var age                                           "Age (years)"

. label var agegroup                                      "Grouped age"

. label var age66                                         "66 years and older"

. label var male                                          "Male"

. label var bmi                                           "Body Mass Index (BMI
> , kg/m2)"

. label var bmicat                                        "Grouped BMI"

. label var bmi_measured_date             "Body Mass Index (BMI, kg/m2), date m
> easured"

. label var obese4cat                                     "Evidence of obesity 
> (4 categories)"

. label var smoke                                         "Smoking status"

. label var smoke_nomiss                          "Smoking status (missing set 
> to non)"

. label var imd                                           "Index of Multiple De
> privation (IMD)"

. label var ethnicity                                     "Ethnicity"

. label var stp                                           "Sustainability and T
> ransformation Partnership"

. lab var tot_adults_hh                           "Total number adults in hh"

. lab var kids_cat4                                       "Exposure (v2) with 4
> -cats"

. lab var kids_cat5                                        "Exposure (v3) with 
> 5-cats"

. 
. * Comorbidities of interest 
. label var asthma                                                "Asthma categ
> ory"

. label var egfr_cat                                              "Calculated e
> GFR"

. label var hypertension                              "Diagnosed hypertension"

. label var chronic_respiratory_disease   "Chronic Respiratory Diseases"

. label var chronic_cardiac_disease               "Chronic Cardiac Diseases"

. label var diabcat                                               "Diabetes"

. label var cancer_haem_cat                                               "Haem
> atological cancer"

. label var cancer_exhaem_cat                                             "Non-
> haematological cancer"

. label var kidney_transplant                                             "Kidn
> ey transplant"     

. label var other_transplant                                              "Othe
> r solid organ transplant"

. label var asplenia                                              "Asplenia"

. label var other_immuno                                  "Immunosuppressed (co
> mbination algorithm)"

. label var chronic_liver_disease                 "Chronic liver disease"

. label var other_neuro                   "Neurological disease"               
>    

. label var stroke_dementia                           "Stroke or dementia"     
>                                                    

. label var ra_sle_psoriasis                              "Autoimmune disease"

. lab var egfr                                                    eGFR

. lab var perm_immunodef                                  "Permanent immunosupp
> ression"

. lab var temp_immunodef                                  "Temporary immunosupp
> ression"

. lab var esrd                                                    "End-stage re
> nal disease"

. lab var anycomorb                                               "Any comorbid
> ity"

. 
. label var hypertension_date                                     "Diagnosed hy
> pertension Date"

. label var chronic_respiratory_disease_date      "Other Respiratory Diseases D
> ate"

. label var chronic_cardiac_disease_date          "Other Heart Diseases Date"

. label var diabetes_date                                         "Diabetes Dat
> e"

. label var cancer_haem_date                                      "Haem cancer 
> Date"

. label var cancer_nonhaem_date                           "Non-haem cancer Date
> "

. label var chronic_liver_disease_date            "Chronic liver disease Date"

. label var other_neuro_date              "Neurological disease  Date"

. label var stroke_dementia_date                      "Stroke or dementia date"
>                                                    

. label var ra_sle_psoriasis_date                         "Autoimmune disease  
> Date"

. lab var perm_immunodef_date                             "Permanent immunosupp
> ression date"

. lab var temp_immunodef_date                             "Temporary immunosupp
> ression date"

. label var kidney_transplant_date                                             
>    "Kidney transplant"     

. label var other_transplant_date                                         "Othe
> r solid organ transplant"

. label var asplenia_date                                                 "Aspl
> enia date"

. lab var  bphigh "non-missing indicator of known high blood pressure"

. lab var bpcat "Blood pressure four levels, non-missing"

. lab var htdiag_or_highbp "High blood pressure or hypertension diagnosis"

. lab var shield "Probable shielding"

. 
. * Outcomes and follow-up
. label var enter_date                                    "Date of study entry"

. label var study_end_censor                      "Date of admin censoring for 
> outcomes"

. lab var SUS_study_end_censor                    "Date censoring for SUS"

. 
. label var  covid_tpp_prob                               "Failure/censoring in
> dicator for outcome: covid prob case"

. label var  non_covid_death                              "Failure/censoring in
> dicator for outcome: non-covid death"

. label var  covid_death                              "Failure/censoring indica
> tor for outcome: covid death"

. label var  covid_icu                                "Failure/censoring indica
> tor for outcome: covid icu"

. lab var covidadmission                                  "Failure/censoring in
> dicator for outcome: covid SUS admission"

. lab var covid_death_part1                               "Failure/censoring in
> dicator for outcome: covid death part1"

. lab var  positive_SGSS          "Indicator positive covid test"

. lab var  covid_primary_care_codes               "Indicator positive primary c
> are code COVID infection"

. lab var reported_infection_source               "Reported Infection Source"

. 
. rename died_date_onsnoncovid date_non_covid_death

. rename died_date_onscovid date_covid_death

. rename covid_icu_date date_covid_icu

. rename covid_admission_primary_date date_covidadmission

. label var date_covid_tpp_prob                   "Date of probable COVID-19 cl
> inical infection"

. label var date_non_covid_death                  "Date of ONS non-COVID-19 Dea
> th"

. label var  date_covid_death                     "Date of ONS COVID-19 Death"

. lab var date_covid_icu                                  "Date of admission to
>  ICU for COVID-19" 

. lab var date_covidadmission                     "Date of admission to hospita
> l for COVID-19" 

. label var  died_date_onscovid_part1                     "Date of ONS COVID De
> ath part1"

. lab var  date_positive_SGSS             "Date of positive SGSS test"

. lab var   date_covid_primary_care_codes "Date of COVID-19 primary care code"

. 
. * Survival times
. label var  stime_covid_tpp_prob                         "Survival tme (date);
>  outcome "

. label var  stime_non_covid_death                        "Survival tme (date);
>  outcome non_covid_death   "

. label var  stime_covid_death                            "Survival time (date)
> ; outcome covid death"

. label var  stime_covid_icu                                      "Survival tim
> e (date); outcome covid icu"

. label var  stime_covidadmission                         "Survival time (date)
> ; outcome covid hosp admission"

. label var  stime_covid_death_part1                              "Survival tim
> e (date); outcome covid death part1"

. 
. *Key DATES
. label var   died_date_ons                               "Date death ONS"

. label var  has_12_m_follow_up                   "Has 12 months follow-up"

. lab var  dereg_date                                             "Date deregis
> tration from practice"

. 
. 
. 
. 
. /* TIDY DATA=================================================================
> =*/
. *  Drop variables that are not needed (those not labelled)
. ds, not(varlabel)
ethnicity_~e  hba1c_mmol~e  sgtf          asthmacat     SCr_adj
bmi_measured  hba1c_per~te  lft_pcr       diabetes      min
bp_sys_dat~e  cancer_haem   sex           covid_tpp_~l  max
bp_sys_dat~d  cancer_non~m  care_home_~e  covid_tpp_~t  hba1c_pct
bp_dias_da~e  esrf_date     bp_sys        covid_tpp_~q  dm_type
bp_dias_da~d  esrf          bp_dias       covid_admi~e  hba1ccat
crea~te_date  dialysis_d~e  creatinine    age_drop      hba1c75
crea~ne_date  dialysis      diabetes_t~e  no_of_kids
smoki~e_date  died_ons_c~y  hba1c_mmol~l  bmi_time
smoki~s_date  died_ons_c~g  hba1c_per~ge  bmi_age

. drop `r(varlist)'

. drop covid_admission_primary_diagnosi   

. 
.         
. 
. /* APPLY INCLUSION/EXCLUIONS=================================================
> =*/ 
. 
. *************TEMP DROP TO INVESTIGATE ASSOCIATIONS MORE EASILY***************
> ***
. noi di "DROP AGE >110:"
DROP AGE >110:

. drop if age > 110 & age != .
(0 observations deleted)

. count
  22,989

. 
. noi di "DROP IF DIED BEFORE INDEX"
DROP IF DIED BEFORE INDEX

. drop if died_date_ons <=enter_date
(0 observations deleted)

. count
  22,989

. 
. noi di "DROP IF COVID IN TPP BEFORE INDEX"
DROP IF COVID IN TPP BEFORE INDEX

. drop if date_covid_tpp_prob <=enter_date
(0 observations deleted)

. count
  22,989

. 
. noi di "DROP IMD MISSING"
DROP IMD MISSING

. recode imd .=9
(imd: 0 changes made)

. recode imd .u=9
(imd: 0 changes made)

. drop if imd==9
(0 observations deleted)

. count
  22,989

. 
. noi di "DROP MISSING GENDER:"
DROP MISSING GENDER:

. recode male .=9
(male: 0 changes made)

. recode male .u=9
(male: 0 changes made)

. drop if male==9
(0 observations deleted)

. count   
  22,989

.         
. ***************
. *  Save data  *
. ***************
. sort patient_id

. save $tempdir/analysis_dataset_with_missing_ethnicity, replace
(note: file tempdata/analysis_dataset_with_missing_ethnicity.dta not found)
file tempdata/analysis_dataset_with_missing_ethnicity.dta saved

. 
. noi di "DROP NO ETHNICITY DATA"
DROP NO ETHNICITY DATA

. keep if ethnicity!=.u   
(2,319 observations deleted)

. 
. save $tempdir/analysis_dataset, replace
(note: file tempdata/analysis_dataset.dta not found)
file tempdata/analysis_dataset.dta saved

. 
. 
. 
. use  $tempdir/analysis_dataset, clear

. keep if age<=65
(4,559 observations deleted)

. * Create restricted cubic splines for age
. mkspline age = age, cubic nknots(4)

. save $tempdir/analysis_dataset_ageband_0, replace
(note: file tempdata/analysis_dataset_ageband_0.dta not found)
file tempdata/analysis_dataset_ageband_0.dta saved

. 
. 
. use  $tempdir/analysis_dataset, clear

. keep if age>65
(16,111 observations deleted)

. * Create restricted cubic splines for age
. mkspline age = age, cubic nknots(4)

. save $tempdir/analysis_dataset_ageband_1, replace
(note: file tempdata/analysis_dataset_ageband_1.dta not found)
file tempdata/analysis_dataset_ageband_1.dta saved

. 
. 
. 
. forvalues x=0/1 {
  2. 
. use $tempdir/analysis_dataset_ageband_`x', clear
  3. * Save a version set on NON ONS covid death outcome
. stset stime_non_covid_death, fail(non_covid_death)                           
>    ///
>         id(patient_id) enter(enter_date) origin(enter_date)
  4. /*WEIGHTING - TO REDUCE TIME 
> set seed 30459820
> keep if _d==1|uniform()<.03
> gen pw = 1
> replace pw = (1/0.03) if _d==0
> stset stime_non_covid_death [pweight = pw],  fail(non_covid_death)           
>                    ///
>         id(patient_id) enter(enter_date) origin(enter_date)*/
. save "$tempdir/cr_create_analysis_dataset_STSET_non_covid_death_ageband_`x'.d
> ta", replace
  5.         
. /*no longer using composite outcome
> use $tempdir/analysis_dataset_ageband_`x', clear
> * Save a version set on covid death/icu  outcome
> stset stime_covid_death_icu, fail(covid_death_icu)                           
>    ///
>         id(patient_id) enter(enter_date) origin(enter_date)
> save "$tempdir/cr_create_analysis_dataset_STSET_covid_death_icu_ageband_`x'.d
> ta", replace
> */
. use $tempdir/analysis_dataset_ageband_`x', clear
  6. * Save a version set on covid icu  outcome only
. stset stime_covid_icu, fail(covid_icu)                          ///
>         id(patient_id) enter(enter_date) origin(enter_date)
  7. save "$tempdir/cr_create_analysis_dataset_STSET_covid_icu_ageband_`x'.dta"
> , replace
  8. 
. use $tempdir/analysis_dataset_ageband_`x', clear
  9. * Save a version set on covid death only
. stset stime_covid_death, fail(covid_death)                              ///
>         id(patient_id) enter(enter_date) origin(enter_date)
 10. save "$tempdir/cr_create_analysis_dataset_STSET_covid_death_ageband_`x'.dt
> a", replace
 11. 
. /*this was created for investigation only
> use $tempdir/analysis_dataset_ageband_`x', clear
> * Save a version set on covid death only
> stset stime_covid_death_part1, fail(covid_death_part1)                       
>    ///
>         id(patient_id) enter(enter_date) origin(enter_date)
> save "$tempdir/cr_create_analysis_dataset_STSET_covid_death_part1_ageband_`x'
> .dta", replace
> */
. use $tempdir/analysis_dataset_ageband_`x', clear
 12. * Save a version set on probable covid
. stset stime_covid_tpp_prob, fail(covid_tpp_prob)                             
>    ///
>         id(patient_id) enter(enter_date) origin(enter_date)
 13. save "$tempdir/cr_create_analysis_dataset_STSET_covid_tpp_prob_ageband_`x'
> .dta", replace        
 14. 
. use $tempdir/analysis_dataset_ageband_`x', clear
 15. * Save a version set on hosp admission for covid
. stset stime_covidadmission, fail(covidadmission)                             
>    ///
>         id(patient_id) enter(enter_date) origin(enter_date)
 16. save "$tempdir/cr_create_analysis_dataset_STSET_covidadmission_ageband_`x'
> .dta", replace        
 17. 
. }

                id:  patient_id
     failure event:  non_covid_death != 0 & non_covid_death < .
obs. time interval:  (stime_non_covid_death[_n-1], stime_non_covid_death]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date

------------------------------------------------------------------------------
     16,111  total observations
          3  observations end on or before enter()
------------------------------------------------------------------------------
     16,108  observations remaining, representing
     16,108  subjects
      4,912  failures in single-failure-per-subject data
  2,072,507  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =       208
(note: file tempdata/cr_create_analysis_dataset_STSET_non_covid_death_ageband_0
> .dta not found)
file tempdata/cr_create_analysis_dataset_STSET_non_covid_death_ageband_0.dta sa
> ved

                id:  patient_id
     failure event:  covid_icu != 0 & covid_icu < .
obs. time interval:  (stime_covid_icu[_n-1], stime_covid_icu]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date

------------------------------------------------------------------------------
     16,111  total observations
          3  observations end on or before enter()
------------------------------------------------------------------------------
     16,108  observations remaining, representing
     16,108  subjects
     12,211  failures in single-failure-per-subject data
  1,464,691  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =       208
(note: file tempdata/cr_create_analysis_dataset_STSET_covid_icu_ageband_0.dta n
> ot found)
file tempdata/cr_create_analysis_dataset_STSET_covid_icu_ageband_0.dta saved

                id:  patient_id
     failure event:  covid_death != 0 & covid_death < .
obs. time interval:  (stime_covid_death[_n-1], stime_covid_death]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date

------------------------------------------------------------------------------
     16,111  total observations
          3  observations end on or before enter()
------------------------------------------------------------------------------
     16,108  observations remaining, representing
     16,108  subjects
      7,347  failures in single-failure-per-subject data
  2,072,507  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =       208
(note: file tempdata/cr_create_analysis_dataset_STSET_covid_death_ageband_0.dta
>  not found)
file tempdata/cr_create_analysis_dataset_STSET_covid_death_ageband_0.dta saved

                id:  patient_id
     failure event:  covid_tpp_prob != 0 & covid_tpp_prob < .
obs. time interval:  (stime_covid_tpp_prob[_n-1], stime_covid_tpp_prob]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date

------------------------------------------------------------------------------
     16,111  total observations
          3  observations end on or before enter()
------------------------------------------------------------------------------
     16,108  observations remaining, representing
     16,108  subjects
     14,619  failures in single-failure-per-subject data
  1,334,617  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =       208
(note: file tempdata/cr_create_analysis_dataset_STSET_covid_tpp_prob_ageband_0.
> dta not found)
file tempdata/cr_create_analysis_dataset_STSET_covid_tpp_prob_ageband_0.dta sav
> ed

                id:  patient_id
     failure event:  covidadmission != 0 & covidadmission < .
obs. time interval:  (stime_covidadmission[_n-1], stime_covidadmission]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date

------------------------------------------------------------------------------
     16,111  total observations
         19  observations end on or before enter()
------------------------------------------------------------------------------
     16,092  observations remaining, representing
     16,092  subjects
      1,927  failures in single-failure-per-subject data
  1,787,018  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =       178
(note: file tempdata/cr_create_analysis_dataset_STSET_covidadmission_ageband_0.
> dta not found)
file tempdata/cr_create_analysis_dataset_STSET_covidadmission_ageband_0.dta sav
> ed

                id:  patient_id
     failure event:  non_covid_death != 0 & non_covid_death < .
obs. time interval:  (stime_non_covid_death[_n-1], stime_non_covid_death]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date

------------------------------------------------------------------------------
      4,559  total observations
          1  observation ends on or before enter()
------------------------------------------------------------------------------
      4,558  observations remaining, representing
      4,558  subjects
      1,431  failures in single-failure-per-subject data
    587,956  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =       208
(note: file tempdata/cr_create_analysis_dataset_STSET_non_covid_death_ageband_1
> .dta not found)
file tempdata/cr_create_analysis_dataset_STSET_non_covid_death_ageband_1.dta sa
> ved

                id:  patient_id
     failure event:  covid_icu != 0 & covid_icu < .
obs. time interval:  (stime_covid_icu[_n-1], stime_covid_icu]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date

------------------------------------------------------------------------------
      4,559  total observations
          1  observation ends on or before enter()
------------------------------------------------------------------------------
      4,558  observations remaining, representing
      4,558  subjects
      3,460  failures in single-failure-per-subject data
    412,321  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =       208
(note: file tempdata/cr_create_analysis_dataset_STSET_covid_icu_ageband_1.dta n
> ot found)
file tempdata/cr_create_analysis_dataset_STSET_covid_icu_ageband_1.dta saved

                id:  patient_id
     failure event:  covid_death != 0 & covid_death < .
obs. time interval:  (stime_covid_death[_n-1], stime_covid_death]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date

------------------------------------------------------------------------------
      4,559  total observations
          1  observation ends on or before enter()
------------------------------------------------------------------------------
      4,558  observations remaining, representing
      4,558  subjects
      2,025  failures in single-failure-per-subject data
    587,956  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =       208
(note: file tempdata/cr_create_analysis_dataset_STSET_covid_death_ageband_1.dta
>  not found)
file tempdata/cr_create_analysis_dataset_STSET_covid_death_ageband_1.dta saved

                id:  patient_id
     failure event:  covid_tpp_prob != 0 & covid_tpp_prob < .
obs. time interval:  (stime_covid_tpp_prob[_n-1], stime_covid_tpp_prob]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date

------------------------------------------------------------------------------
      4,559  total observations
          1  observation ends on or before enter()
------------------------------------------------------------------------------
      4,558  observations remaining, representing
      4,558  subjects
      4,117  failures in single-failure-per-subject data
    387,249  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =       208
(note: file tempdata/cr_create_analysis_dataset_STSET_covid_tpp_prob_ageband_1.
> dta not found)
file tempdata/cr_create_analysis_dataset_STSET_covid_tpp_prob_ageband_1.dta sav
> ed

                id:  patient_id
     failure event:  covidadmission != 0 & covidadmission < .
obs. time interval:  (stime_covidadmission[_n-1], stime_covidadmission]
 enter on or after:  time enter_date
 exit on or before:  failure
    t for analysis:  (time-origin)
            origin:  time enter_date

------------------------------------------------------------------------------
      4,559  total observations
          4  observations end on or before enter()
------------------------------------------------------------------------------
      4,555  observations remaining, representing
      4,555  subjects
        535  failures in single-failure-per-subject data
    506,608  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =       178
(note: file tempdata/cr_create_analysis_dataset_STSET_covidadmission_ageband_1.
> dta not found)
file tempdata/cr_create_analysis_dataset_STSET_covidadmission_ageband_1.dta sav
> ed

. 
. * Close log file 
. log close
      name:  <unnamed>
       log:  /workspace/logs/01_cr_analysis_dataset.log
  log type:  text
 closed on:  27 Jul 2021, 11:18:23
-------------------------------------------------------------------------------
